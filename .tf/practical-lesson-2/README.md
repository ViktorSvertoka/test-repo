# Практичне заняття №2

**Вітаю на другому практичному занятті!**

VPC та EC2-інстанси ми вже створювали на минулому занятті, тому не будемо витрачати на них час, вони вже створені за допомогою [terraform](https://www.terraform.io/).

**Сьогодні розглядаємо**:

- Створення бази даних в приватній мережі (Тема 6. Сховища даних в AWS)
- Доступ до приватної бази даних через так званий bastion-інстанс
- Створення повноцінного web-застосунку в ECS (Тема 5. Контейнеризація в AWS)

> [!IMPORTANT]
> Всі ключі, паролі, посилання, тощо будуть недійсні вже по закінченню заняття!

## Завдання

1. Створити RDS для проєкту
   - Створити Security group, яка дозволяє доступ до бази даних лише всередині мережі (`100.64.0.0/16` або security group `django-application`)
   - Створити Subnet group в приватній мережі
   - Створити RDS-інстанс db.t3.micro без публічного доступу
   - Дані для підключення пошерити в Slack
2. Налаштувати bastion-інстанс
   - Встановити postgresql для прямого доступу до бази даних, перевірити доступ до бази даних
   - Зклонувати репозиторій django_app, створити віртуальне середовище (virtualenv/venv) та активувати
   - Встановити залежності
   - Налаштувати змінні оточення, створити таблиці в базі даних (`python3 manage.py migrate`) та адміністратора сайту (`python3 manage.py createsuperuser`)
3. Підготувати docker-image
   - Зклонувати git-репозиторій з кодом
   - Створити ECR-репозиторій
   - Збілдити docker-image
   - Запушити в ECR (памʼятаємо про `--profile`!)
4. Створити ECS-кластер
   - Створити ECS-кластер
   - Створити визначення завдання (Task definition) з параметрами:
     - **Launch type**: `AWS Fargate`
     - **Operating system/Architecture**: `Linux/X86_64` (або `Linux/ARM64`, якщо образ на минулому кроці був створений на Mac)
     - **Task size**:
       - **CPU**: `.25 vCPU`
       - **Memory**: `.5 GB`
   - На базі створеного визначення завдання створити сервіс з Desired tasks: 2 в публічній підмережі з балансувальником навантаження

## Самостійне відтворення чи повторення

> [!NOTE]
> [terraform](https://www.terraform.io/) не входить в рамки курсу Foundations of Cloud Computing!  
> Ментор не зобовʼязаний допомагати із проблемами, повʼязаними з його неналежним використанням!

### Створення підготовленої інфраструктури

Щоб потренуватися самостійно (чи ще раз) над завданнями, [встановіть terraform](https://developer.hashicorp.com/terraform/install), зклонуйте цей репозиторій і в ньому перейдіть в папку `.tf/practical-lesson-2`, ініціалізуйте terraform та застосуйте:

```bash
cd .tf/practical-lesson-2
terraform init
terraform apply
```

> [!WARNING]
> Без додаткових налаштувань terraform буде використовувати дані з дефолтного профілю!  
> https://registry.terraform.io/providers/hashicorp/aws/latest/docs?product_intent=terraform#authentication-and-configuration  
> Впевніться, що Ви використовуєте в дефолтному профілі саме свій аккаунт!

### Видалення підготовленої інфраструктури

**Лише після видалення всього, що створите по завданню**, видаліть створені за допомогою terraform ресурси командою

```bash
terraform destroy
```

> [!IMPORTANT]
> Якщо в VPC на момент виконання команди будуть існувати ресурси, про яких не знає terraform, скоріш за все дестрой зафейлиться
